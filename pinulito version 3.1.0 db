------------------------------ header leyenda
/****** Object:  Table [dbo].[LEYENDA_H]    Script Date: 20/06/2019 15:51:44 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LEYENDA_H](
	[EMPRESA] [varchar](5) NOT NULL,
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[FECHAINI] [datetime] NOT NULL,
	[FECHAFIN] [datetime] NOT NULL,
	[DESCRIPCION] [varchar](250) NULL,
 CONSTRAINT [PK_LEYENDA_H] PRIMARY KEY CLUSTERED 
(
	[EMPRESA] ASC,
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 80) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
------------------------------ detalle leyenda

/****** Object:  Table [dbo].[LEYENDA_D]    Script Date: 20/06/2019 16:03:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LEYENDA_D](
	[EMPRESA] [varchar](5) NOT NULL,
	[ID] [int] NOT NULL,
	[NO_LINEA] [int] NOT NULL,
	[IMPRESION] [varchar](40) NOT NULL,
	[ORDEN] [numeric](18, 0) NULL,
	[JUSTIFICADO] [char](1) NULL,
 CONSTRAINT [PK_LEYENDA_D] PRIMARY KEY CLUSTERED 
(
	[EMPRESA] ASC,
	[ID] ASC,
	[NO_LINEA] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 80) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
-----------------------------TABLA ERRROES CONTIENGENCIA
/****** Object:  Table [dbo].[ERRORES_CONTINGENCIA]    Script Date: 20/06/2019 17:28:36 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ERRORES_CONTINGENCIA](
	[EMPRESA] [varchar](5) NOT NULL,
	[ID] [int] NOT NULL,
	[DESCRIPCION] [text] NOT NULL,
	[TIPO] [int] NOT NULL,
 CONSTRAINT [PK_ERRORES_CONTINGENCIA] PRIMARY KEY CLUSTERED 
(
	[EMPRESA] ASC,
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO

-------------------------------------- PROCEDIMIENTO RED_LEYENDA_H

CREATE PROCEDURE RED_LEYENDA_H
	@EMPRESA VARCHAR(5)
AS
BEGIN
	Select Empresa, Id, FechaIni, FechaFin, Descripcion 
	from LEYENDA_H
	where Empresa = @EMPRESA
END
GO


----------------------------------------- PROCEDIMIENTO RED_LEYENDA_D


CREATE PROCEDURE RED_LEYENDA_D
	@EMPRESA VARCHAR(5)
AS
BEGIN
	Select EMPRESA, ID, NO_LINEA, IMPRESION, ORDEN, JUSTIFICADO
	from LEYENDA_D
	where Empresa = @EMPRESA
END
GO
---------------------------------------- STORE GET ERRORES CONTIENGENCIA 


CREATE PROCEDURE [dbo].[RED_LISTA_ERRORES] 
	@EMPRESA VARCHAR(5)
AS
BEGIN
	select EMPRESA,ID,DESCRIPCION,TIPO FROM ERRORES_CONTINGENCIA
END


--------------------------------------- FUNCION F_LEYENDAS


/****** Object:  UserDefinedFunction [dbo].[F_LEYENDAS]    Script Date: 2/07/2019 15:19:13 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [dbo].[F_LEYENDAS]
(@EMPRESA VARCHAR(5),	@FECHA DATETIME)
RETURNS @LEYENDAS 
TABLE (IMPRESION VARCHAR(40), ORDEN varchar(3), JUSTIFICACION VARCHAR(5))
AS
BEGIN
INSERT INTO @LEYENDAS
(IMPRESION, ORDEN, JUSTIFICACION)
SELECT 
	D.IMPRESION, D.ORDEN, D.JUSTIFICADO 
FROM LEYENDA_H H INNER JOIN LEYENDA_D D ON
		H.EMPRESA = D.EMPRESA AND
		H.ID = D.ID
WHERE 
	H.EMPRESA=@EMPRESA AND
	@FECHA BETWEEN FECHAINI AND FECHAFIN
ORDER BY ORDEN
RETURN
END
GO


--------------------------------------------------------


-- =============================================
-- Author:		Fernando Paniagua
-- Create date: 20190702
-- Description:	Devuelve Listado de CXP_TIPO_DOCTO para m√©todo ws_RedEmpresarial 
-- =============================================
CREATE PROCEDURE RED_CXP_TIPO_DOCTO
	@EMPRESA VARCHAR(5)
AS
BEGIN
	Select Empresa as Empresa, Tipo_Docto as TipoDocto, descripcion as  Descripcion
	from CXP_TIPO_DOCTO
	where Empresa = @EMPRESA
END
GO



